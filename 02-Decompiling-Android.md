# Week 2: Domain Background and Data (a first look)

## Topics

* What is Malware? What does it do?
* Identifying Malware by code structure: Libraries, APIs, and network
  calls.
* Decompiling android bytecode to Smali code (and interpreting it).

## Apks and Smali code

Android apps are written in Java and compiled to *Dalvik* bytecode,
and distributed in zipped files called *apk*s, to be run on a
phone. The bytecode is denoted with the `.dex` file suffix. To
statically analyze android code, we need to decompile these `dex`
files to a representation in what's called *Smali code*. Since we will
be attempting to understand what code does from Smali files, we need
to understand how Smali represents Java source code.

1. To download `apk` files directly on your computer, you can use
   [www.apkpure.com](www.apkpure.com). To obtain an apk file from the
   play store, you would need to install it on a phone, then grab the
   file from the mobile device (not recommended).
2. To decompile an Android Apk to Smali code, download and use
   [ApkTool](https://ibotpeaches.github.io/Apktool/). Follow the
   download instructions and run it on a sample (benign) android app.

## Intro to Graphs

We will use python and
[networkX](https://networkx.github.io/documentation/stable/index.html)
to work and visualize graph structures. Install the package on your
machine and work through the
[tutorial](https://networkx.github.io/documentation/stable/tutorial.html)
in the documentation. 

## Additional Reading

* Read
  [slides](http://www.syssec-project.eu/m/page-media/158/syssec-summer-school-Android-Code-Injection.pdf)
  on the process of creating Smali code. The slides more generally
  speak about recompiling an App after changing Smali code (perhaps
  injecting malicious code). While interesting, you only need to focus
  on the slides decribing the correspondence between Java source code
  and Smali code.
* Read this
  [post](https://duo.com/decipher/hunting-malicious-npm-packages)
  about searching for malicious Javascript using static code
  analysis. This article uses the dependency graph of different
  programs to emphasize how much unknown code you may be installing,
  even when installing a "trusted" library (`npm` is javascripts package
  manager, much like python's `pip`).
    
## Discussion questions from the reading/data

* Download a “HelloWorld” apk from apkpure and convert it to smali
  code. Find similar source (Java) code for an HelloWorld app and
  understand all the pieces of the smali code. To find an app, search
  apkpure and github.
* Pick 10 (known) Android apps from the apk-pure, download the apk, and
  convert to smali code.
* For a given application’s smali code, compute statistics summarizing
  the code: What methods types exist? What are the return types? What
  type of invocations exist? Just do a first-hack EDA and make some
  observations.
* For a given application’s smali code, create the (directed) inheritance graph of the application:
  - The nodes are classes.
  - Class A is connected to Class B if Class A is a subclass of Class B.
